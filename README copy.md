<!-- Badges -->
<div align="center">

[![License: CC BY-NC 4.0](https://img.shields.io/badge/License-CC%20BY--NC%204.0-lightgrey.svg)](https://creativecommons.org/licenses/by-nc/4.0/)
[![Next.js](https://img.shields.io/badge/Next.js-16-black?logo=next.js)](https://nextjs.org/)
[![React](https://img.shields.io/badge/React-19-61DAFB?logo=react)](https://react.dev/)
[![Sanity](https://img.shields.io/badge/Sanity-App%20SDK-F03E2F?logo=sanity)](https://www.sanity.io/)
[![Clerk](https://img.shields.io/badge/Clerk-AgentKit-6C47FF?logo=clerk)](https://clerk.com/)
[![Stripe](https://img.shields.io/badge/Stripe-Payments-008CDD?logo=stripe)](https://stripe.com/)
[![AI](https://img.shields.io/badge/AI-Claude%20Sonnet-00A67E)](https://www.anthropic.com/)

</div>

# ğŸ›‹ï¸ AI-Powered E-commerce Platform with Real-time Content

> Build a modern furniture e-commerce store with an AI shopping assistant, real-time inventory updates, and a powerful admin dashboard â€” all powered by cutting-edge technologies.

<div align="center">

| ğŸ‘¥ **Who It's For** | âš¡ **Key Differentiators** | ğŸ”§ **Technical Highlights** |
|:---:|:---:|:---:|
| Developers learning modern full-stack patterns with AI integration | **Sanity App SDK** for real-time data & **Clerk AgentKit** for authenticated AI tools | Claude AI shopping assistant, live inventory updates, Stripe checkout |

</div>

---

## ğŸ‘‡ğŸ¼ DO THIS Before You Get Started

Use THESE links to set up your accounts (It's a special affiliate link which lets us continue to do builds like this FREE for you!):

- [**Get Started with Sanity â†’**](https://www.sanity.io/sonny?utm_source=youtube&utm_medium=video&utm_content=ai-ecommerce-platform)
- [**Get Started with Clerk â†’**](https://go.clerk.com/uc48FAP)

| Service | Description | â€¼ï¸ LINK TO USE â€¼ï¸ |
|---------|-------------|------|
| ğŸ§¡ **Sanity** | Headless CMS with real-time capabilities & App SDK | [**Get Started with Sanity â†’**](https://www.sanity.io/sonny?utm_source=youtube&utm_medium=video&utm_content=ai-ecommerce-platform) |
| ğŸ’œ **Clerk** | Authentication with AgentKit for AI context | [**Get Started with Clerk â†’**](https://go.clerk.com/uc48FAP) |

---

## ğŸ¤” What Is This App?

**Think of it as a furniture store with a brain.**

This is a full-featured e-commerce platform where customers can:

- ğŸ›’ **Browse & Buy** â€” Shop premium furniture with real-time stock updates
- ğŸ¤– **Chat with AI** â€” Ask the AI assistant to find products, check prices, or track orders
- ğŸ“¦ **Track Orders** â€” View order history and delivery status (when signed in)

And store owners get:

- ğŸ“Š **AI-Powered Insights** â€” Dashboard with sales trends, inventory alerts, and action items
- âœï¸ **Real-time Editing** â€” Manage products and orders with instant updates via Sanity App SDK
- ğŸ”” **Smart Alerts** â€” Low stock warnings and unfulfilled order notifications

### Key Concepts Explained

| Term | What It Means |
|------|---------------|
| **CMS (Content Management System)** | Where all your products, orders, and content live â€” in this case, Sanity |
| **Real-time Content** | When you update a product in Sanity, it instantly appears on the website |
| **AI Shopping Assistant** | A chatbot powered by Claude AI that can search products and check your orders |
| **App SDK** | Sanity's toolkit for building custom applications with direct database access |

---

## ğŸ¯ What You'll Learn

âœ… **Next.js 16** with App Router & Server/Client Components + Server Actions!

âœ… **Clerk authentication** with AgentKit for AI-aware user context!

âœ… **Sanity CMS** with App SDK for real-time data mutations & live content updates!

âœ… **Vercel AI SDK** with AI Gateway for multi-provider LLM support (Claude, GPT, Cohere)!

âœ… **Stripe payments** with webhooks for secure checkout & order processing!

âœ… **shadcn/ui + Tailwind CSS v4** for beautiful, accessible UI components!

âœ… **Zustand state management** with localStorage persistence for cart!

âœ… **Mobile-responsive design** with modern layouts & dark mode!

âœ… **AI Shopping Assistant** with custom tools for product search & order tracking!

âœ… **AI Admin Dashboard** with Claude-powered insights, sales trends & recommendations!

âœ… **GROQ queries** with TypeGen for type-safe Sanity data fetching!

âœ… **Real-time UI updates** via Sanity Live â€” no polling required!

âœ… **Custom AI tools** scoped to authenticated users (orders only visible when signed in)!

âœ… **Webhook-driven order creation** with automatic stock management!

âœ… **Embedded Sanity Studio** for content management at `/studio`! + SO MUCH MORE!

---

## ğŸš€ Before We Dive In - Join the PAPAFAM!

**Want to build apps like this from scratch?**

Join thousands of developers learning to build production-ready applications with the latest technologies.

### PAPAFAM Community Benefits

- ğŸ“ Step-by-step video tutorials
- ğŸ’¬ Private Discord community
- ğŸ”¥ Weekly coding challenges
- ğŸ“ Access to all project source code
- ğŸ† Certificate of completion

### Real Results

> "I landed my first developer job after completing the PAPAFAM course!" â€” Community Member

<div align="center">

### [ğŸ¯ Join the PAPAFAM Course â†’](https://www.papareact.com/course)

</div>

---

## âœ¨ Features

### For Shoppers

| Feature | Description |
|---------|-------------|
| ğŸ¤– **AI Shopping Assistant** | Natural language product search, filter by material/color/price, get recommendations |
| ğŸ“¦ **Order Tracking** | View your order history and status (requires sign-in) |
| ğŸ›’ **Smart Cart** | Persistent cart with real-time stock validation |
| ğŸ’³ **Secure Checkout** | Stripe-powered payments with address collection |
| ğŸ”„ **Real-time Stock** | See live inventory levels â€” no surprises at checkout |

### For Admins

| Feature | Description |
|---------|-------------|
| ğŸ§  **AI Dashboard Insights** | Sales trends, inventory alerts, and actionable recommendations powered by Claude |
| ğŸ“ **Product Management** | Create, edit, and publish products directly via Sanity App SDK |
| ğŸ“‹ **Order Management** | Update order status (paid â†’ shipped â†’ delivered) |
| âš ï¸ **Low Stock Alerts** | Automatic warnings when inventory runs low |
| ğŸ“Š **Analytics** | Revenue tracking, order counts, and performance metrics |

### Technical Features (The Smart Stuff)

| Feature | Technology | Why It Matters |
|---------|------------|----------------|
| âš¡ **Real-time Updates** | Sanity Live + App SDK | Content changes appear instantly without refresh |
| ğŸ” **Authenticated AI** | Clerk AgentKit | AI assistant knows who you are and can access YOUR orders |
| ğŸ§  **AI Gateway** | Vercel AI Gateway | Use Claude, GPT, or other models â€” easily swappable |
| ğŸ›’ **Persisted Cart** | Zustand + localStorage | Cart survives page refreshes and browser restarts |
| ğŸ“± **Responsive Design** | Tailwind CSS + Shadcn/UI | Beautiful UI on any device |
| âš™ï¸ **Type Safety** | TypeScript + Sanity TypeGen | Auto-generated types from your CMS schema |

---

## ğŸ”„ How It Works

### User Shopping Flow

```mermaid
flowchart LR
    A[Browse Products] --> B[Add to Cart]
    B --> C[Checkout]
    C --> D[Stripe Payment]
    D --> E[Webhook]
    E --> F[Order Created in Sanity]
    F --> G[Stock Updated]
    
    A --> H[Chat with AI]
    H --> I[Search Products]
    H --> J[Check Orders]
```

### AI Assistant Architecture

```mermaid
flowchart TD
    A[User Message] --> B{Clerk Auth Check}
    B --> C[AI Agent - Claude Sonnet]
    C --> D{Tool Selection}
    
    D --> E[searchProducts]
    D --> F[getMyOrders]
    
    E --> G[GROQ Query to Sanity]
    G --> H[Product Results]
    
    F --> I{User Authenticated?}
    I -->|Yes| J[Fetch User Orders]
    I -->|No| K[Prompt to Sign In]
    
    H --> L[AI Response with Product Cards]
    J --> L
```

### Real-time Data Flow

```mermaid
flowchart LR
    subgraph Sanity Cloud
        A[Sanity CMS]
    end
    
    subgraph Next.js App
        B[SanityLive Provider]
        C[Server Components]
        D[Sanity App SDK]
        E[Admin Dashboard]
    end
    
    A -->|Real-time sync| B
    B --> C
    C -->|Live UI updates| F[Customer View]
    
    D -->|Direct mutations| A
    E --> D
```

---

## ğŸš€ Getting Started

### Prerequisites

Before you begin, ensure you have:

- **Node.js 18+** â€” [Download here](https://nodejs.org/)
- **pnpm** â€” Install with `npm install -g pnpm`
- **Sanity Account** â€” [Create free account](https://www.sanity.io/sonny?utm_source=youtube&utm_medium=video&utm_content=ai-ecommerce-platform)
- **Clerk Account** â€” [Create free account](https://go.clerk.com/uc48FAP)
- **Stripe Account** â€” [Create account](https://stripe.com/)
- **Vercel Account** â€” For AI Gateway access

### Step-by-Step Setup

#### 1. Clone the Repository

```bash
git clone https://github.com/sonnysangha/ai-ecommerce-sanity-clerk.git
cd ai-ecommerce-sanity-clerk
```

#### 2. Install Dependencies

```bash
pnpm install
```

#### 3. Set Up Environment Variables

```bash
cp .env.example .env.local
```

Then fill in your values:

```bash
# Sanity
NEXT_PUBLIC_SANITY_PROJECT_ID=Your_value_goes_here
NEXT_PUBLIC_SANITY_DATASET=Your_value_goes_here
NEXT_PUBLIC_SANITY_ORG_ID=Your_value_goes_here
SANITY_API_WRITE_TOKEN=Your_value_goes_here

# Clerk
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=Your_value_goes_here
CLERK_SECRET_KEY=Your_value_goes_here

# Stripe
STRIPE_SECRET_KEY=Your_value_goes_here
# stripe listen --forward-to localhost:3000/api/webhooks/stripe
STRIPE_WEBHOOK_SECRET=Your_value_goes_here

# Vercel
AI_GATEWAY_API_KEY=Your_value_goes_here
```

> âš ï¸ **Security Note**: Never commit `.env.local` to git. The `.gitignore` already excludes it.

> ğŸ’¡ **Tip**: Variables starting with `NEXT_PUBLIC_` are exposed to the browser. Keep sensitive keys (like `CLERK_SECRET_KEY`) without this prefix.

#### 4. Configure Sanity

1. Go to [sanity.io/manage](https://www.sanity.io/manage)
2. Create a new project or select existing
3. Copy your **Project ID** and **Dataset** name
4. Create an API token with **Editor** permissions for `SANITY_API_WRITE_TOKEN`

#### 5. Configure Clerk

1. Go to [dashboard.clerk.com](https://dashboard.clerk.com/)
2. Create a new application
3. Copy your **Publishable Key** and **Secret Key**

#### 6. Configure Stripe

1. Go to [dashboard.stripe.com/apikeys](https://dashboard.stripe.com/apikeys)
2. Copy your **Secret Key** (starts with `sk_test_` for development)
3. For webhooks, run the Stripe CLI:

```bash
stripe listen --forward-to localhost:3000/api/webhooks/stripe
```

4. Copy the webhook signing secret it provides

#### 7. Configure AI Gateway

1. Go to [vercel.com](https://vercel.com/) and navigate to AI Gateway
2. Create an API key
3. The app uses Claude Sonnet 4/4.5 by default, but you can swap to other providers

> ğŸ’¡ **Swappable Models**: The AI Gateway supports OpenAI, Anthropic, Cohere, and more. Check `lib/ai/shopping-agent.ts` to change models.

#### 8. Generate Types & Import Data

```bash
# Generate TypeScript types from Sanity schema
pnpm typegen

# Import sample furniture data
npx sanity dataset import sample-data.ndjson
```

#### 9. Start Development Server

```bash
pnpm dev
```

Open [http://localhost:3000](http://localhost:3000) â€” you're ready to go! ğŸ‰

### First Time Setup Checklist

- [ ] All environment variables filled in `.env.local`
- [ ] Sanity project created with dataset
- [ ] Clerk application created
- [ ] Stripe CLI running for local webhooks
- [ ] Sample data imported
- [ ] Types generated with `pnpm typegen`

---

## ğŸ“Š Database Schema Overview

This app uses **Sanity** as its headless CMS with the following document types:

### Product

| Field | Type | Description |
|-------|------|-------------|
| `name` | string | Product name |
| `slug` | slug | URL-friendly identifier |
| `description` | text | Product description |
| `price` | number | Price in GBP |
| `category` | reference | Link to category |
| `material` | string | wood, metal, fabric, leather, glass |
| `color` | string | black, white, oak, walnut, grey, natural |
| `dimensions` | string | e.g., "120cm x 80cm x 75cm" |
| `stock` | number | Current inventory count |
| `images` | array | Product images with hotspot |
| `featured` | boolean | Show in featured carousel |

### Category

| Field | Type | Description |
|-------|------|-------------|
| `title` | string | Category name |
| `slug` | slug | URL-friendly identifier |
| `description` | text | Category description |
| `image` | image | Category thumbnail |

### Order

| Field | Type | Description |
|-------|------|-------------|
| `orderNumber` | string | Unique order ID (e.g., ORD-ABC123) |
| `items` | array | Products with quantity and price at purchase |
| `total` | number | Order total in GBP |
| `status` | string | pending, paid, shipped, delivered, cancelled |
| `customer` | reference | Link to customer record |
| `clerkUserId` | string | Clerk user identifier |
| `email` | string | Customer email |
| `address` | object | Shipping address |
| `stripePaymentId` | string | Stripe payment intent ID |

### Customer

| Field | Type | Description |
|-------|------|-------------|
| `name` | string | Customer name |
| `email` | string | Customer email |
| `clerkUserId` | string | Clerk user identifier |
| `stripeCustomerId` | string | Stripe customer ID |

---

## ğŸ”§ Key Technical Patterns

### Sanity App SDK Patterns

The admin dashboard uses Sanity App SDK for direct document operations:

```typescript
// app/(admin)/admin/page.tsx
import {
  useApplyDocumentActions,
  createDocumentHandle,
  createDocument,
} from "@sanity/sdk-react";

// Create a new product
const apply = useApplyDocumentActions();

const handleCreateProduct = async () => {
  const newDocHandle = createDocumentHandle({
    documentId: crypto.randomUUID(),
    documentType: "product",
  });
  await apply(createDocument(newDocHandle));
  router.push(`/admin/inventory/${newDocHandle.documentId}`);
};
```

**Key hooks used:**
- `useDocuments()` â€” Reactive document queries
- `useApplyDocumentActions()` â€” Perform mutations (create, update, delete)
- `createDocumentHandle()` â€” Create handles for new documents

### Clerk AgentKit Pattern

The AI assistant uses Clerk to provide user context:

```typescript
// lib/ai/shopping-agent.ts
export function createShoppingAgent({ userId }: { userId: string | null }) {
  const isAuthenticated = !!userId;

  // Tools vary based on authentication
  const tools: Record<string, Tool> = {
    searchProducts: searchProductsTool, // Always available
  };

  // Only add orders tool if user is signed in
  if (isAuthenticated) {
    tools.getMyOrders = createGetMyOrdersTool(userId);
  }

  return new ToolLoopAgent({
    model: gateway("anthropic/claude-sonnet-4.5"),
    instructions: isAuthenticated ? fullInstructions : guestInstructions,
    tools,
  });
}
```

**How it works:**
1. Clerk provides `userId` from the session
2. Agent is created with user-specific tools
3. `getMyOrders` tool is scoped to that user's data

### Custom AI Tools

#### searchProducts Tool

```typescript
// lib/ai/tools/search-products.ts
export const searchProductsTool = tool({
  description: "Search for products in the furniture store",
  inputSchema: z.object({
    query: z.string().optional(),
    category: z.string().optional(),
    material: z.enum(["", "wood", "metal", "fabric", "leather", "glass"]),
    color: z.enum(["", "black", "white", "oak", "walnut", "grey", "natural"]),
    minPrice: z.number().optional(),
    maxPrice: z.number().optional(),
  }),
  execute: async (params) => {
    // Executes GROQ query against Sanity
    const { data: products } = await sanityFetch({
      query: AI_SEARCH_PRODUCTS_QUERY,
      params,
    });
    return { products, found: products.length > 0 };
  },
});
```

#### getMyOrders Tool

```typescript
// lib/ai/tools/get-my-orders.ts
export function createGetMyOrdersTool(userId: string | null) {
  if (!userId) return null; // Not available for guests

  return tool({
    description: "Get the current user's orders",
    inputSchema: z.object({
      status: z.enum(["", "pending", "paid", "shipped", "delivered"]).optional(),
    }),
    execute: async ({ status }) => {
      const { data: orders } = await sanityFetch({
        query: ORDERS_BY_USER_QUERY,
        params: { clerkUserId: userId },
      });
      return { orders, found: orders.length > 0 };
    },
  });
}
```

---

## ğŸš¢ Deployment

### Deploy to Vercel

#### Option 1: Vercel CLI

```bash
# Install Vercel CLI
pnpm install -g vercel

# Deploy
vercel
```

#### Option 2: GitHub Integration

1. Push your code to GitHub
2. Go to [vercel.com/new](https://vercel.com/new)
3. Import your repository
4. Add environment variables
5. Deploy!

### Post-Deployment Checklist

- [ ] All environment variables set in Vercel dashboard
- [ ] Update Stripe webhook URL to production: `https://yourdomain.com/api/webhooks/stripe`
- [ ] Add production domain to Clerk allowed origins
- [ ] Add production domain to Sanity CORS origins
- [ ] Test a complete purchase flow

### Monitoring

- **Vercel Analytics** â€” Performance and usage metrics
- **Sanity Studio** â€” Content management at `/studio`
- **Stripe Dashboard** â€” Payment monitoring
- **Clerk Dashboard** â€” User analytics

---

## ğŸ› Common Issues & Solutions

### Sanity Issues

| Problem | Solution |
|---------|----------|
| "Missing write token" error | Ensure `SANITY_API_WRITE_TOKEN` is set with Editor permissions |
| CORS errors | Add your domain to Sanity project CORS origins |
| Types out of sync | Run `pnpm typegen` after schema changes |

### Clerk Issues

| Problem | Solution |
|---------|----------|
| Middleware not working | Check `middleware.ts` matches Clerk docs |
| User not found in session | Ensure `ClerkProvider` wraps your app |
| AgentKit not getting userId | Verify `auth()` is called server-side |

### Stripe Issues

| Problem | Solution |
|---------|----------|
| Webhook signature failed | Ensure `STRIPE_WEBHOOK_SECRET` matches CLI output |
| Payment succeeded but no order | Check webhook endpoint and Sanity write permissions |
| "API key invalid" | Use test keys (`sk_test_`) for development |

### AI Issues

| Problem | Solution |
|---------|----------|
| "Gateway error" | Verify `AI_GATEWAY_API_KEY` is valid |
| Rate limiting | Implement request throttling or upgrade plan |
| Wrong model response | Check model name in `shopping-agent.ts` |

---

## ğŸ† Take It Further - Challenge Time!

Ready to level up? Try adding these features:

### Beginner Challenges

- [ ] Add product reviews with star ratings
- [ ] Implement a wishlist/favorites feature
- [ ] Add social sharing buttons

### Intermediate Challenges

- [ ] Email notifications via [Resend](https://resend.com/)
- [ ] Product comparison feature
- [ ] Advanced filtering (multiple selections)

### Advanced Challenges

- [ ] AI-powered product recommendations ("You might also like...")
- [ ] Sentiment analysis for reviews
- [ ] Multi-currency support with automatic conversion
- [ ] Inventory forecasting with AI

### Infrastructure Challenges

- [ ] Add Redis caching for frequently accessed products
- [ ] Implement image optimization with Cloudinary
- [ ] Add full-text search with Algolia

---

## ğŸ“„ License

This project is licensed under the **Creative Commons Attribution-NonCommercial 4.0 International License (CC BY-NC 4.0)**.

### âœ… You CAN

- Use this code for personal learning
- Modify and adapt the code
- Share with attribution
- Use in portfolio projects

### âŒ You CANNOT

- Use for commercial purposes without permission
- Sell this code or derivatives
- Remove attribution

### ğŸ’¼ Commercial Licensing

Want to use this for a commercial project? Contact us:

ğŸ“§ **contact@papareact.com**

See [LICENSE.md](./LICENSE.md) for full details.

---

## ğŸ“š Quick Reference

### Useful Commands

| Command | Description |
|---------|-------------|
| `pnpm dev` | Start development server |
| `pnpm build` | Build for production |
| `pnpm start` | Start production server |
| `pnpm typegen` | Generate TypeScript types from Sanity schema |
| `pnpm lint` | Run Biome linter |
| `pnpm format` | Format code with Biome |
| `pnpm typecheck` | Run TypeScript type checking |

### Key Files & Folders

```
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (app)/              # Customer-facing routes
â”‚   â”œâ”€â”€ (admin)/admin/      # Admin dashboard
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ chat/           # AI chat endpoint
â”‚   â”‚   â””â”€â”€ webhooks/stripe # Stripe webhook handler
â”‚   â””â”€â”€ studio/             # Embedded Sanity Studio
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ app/                # Customer UI components
â”‚   â”œâ”€â”€ admin/              # Admin UI components
â”‚   â””â”€â”€ ui/                 # Shadcn/UI components
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ ai/                 # AI agent & tools
â”‚   â”œâ”€â”€ sanity/queries/     # GROQ queries
â”‚   â””â”€â”€ store/              # Zustand stores
â”œâ”€â”€ sanity/
â”‚   â”œâ”€â”€ schemaTypes/        # Sanity document schemas
â”‚   â””â”€â”€ lib/                # Sanity client & utilities
â””â”€â”€ .env.example            # Environment template
```

### Important Concepts

| Concept | File(s) | What It Does |
|---------|---------|--------------|
| Shopping Agent | `lib/ai/shopping-agent.ts` | Configures AI with tools and instructions |
| Search Tool | `lib/ai/tools/search-products.ts` | AI tool for product search |
| Orders Tool | `lib/ai/tools/get-my-orders.ts` | AI tool for user's order history |
| Real-time Data | `sanity/lib/live.ts` | Sanity Live configuration |
| Cart Store | `lib/store/cart-store.ts` | Zustand cart with persistence |
| Admin Actions | `app/(admin)/admin/page.tsx` | Sanity App SDK document operations |

---

<div align="center">

**Built with â¤ï¸ by [Sonny Sangha](https://www.papareact.com/) & the PAPAFAM Community**

[YouTube](https://www.youtube.com/@SonnySangha) Â· [Twitter](https://twitter.com/sonnysangha) Â· [Course](https://www.papareact.com/course)

</div>
